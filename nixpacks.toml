# Nixpacks configuration for T3 Better Auth App
# This configuration uses bun for package management and deployment

# Use bun as the primary provider for faster installs and builds
providers = ["bun"]

[variables]
# Set NODE_ENV to production for optimal performance
NODE_ENV = "production"
# Disable Next.js telemetry in production
NEXT_TELEMETRY_DISABLED = "1"
# Prisma configuration
DATABASE_URL = "file:./prisma/dev.db"
# Better Auth configuration (add your actual values via Coolify environment variables)
BETTER_AUTH_SECRET = "your-secret-key-here"
BETTER_AUTH_URL = "http://localhost:3000"
# Port configuration for deployment
PORT = "3000"

[phases.setup]
# Install system dependencies if needed
aptPkgs = ["curl", "ca-certificates"]

[phases.install]
# Use bun for dependency installation
cmds = [
    "bun install --frozen-lockfile",
    "bun run postinstall"
]

[phases.build]
# Database setup and application build
cmds = [
    "mkdir -p prisma",
    "bunx prisma generate",
    "bunx prisma migrate deploy",
    "bun run build"
]

[phases.start]
# Start the production server
cmd = "bun run start"

# The start phase will expose port 3000
# Health check endpoint is available at /api/health
